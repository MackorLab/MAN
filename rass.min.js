const waitFor1 = (ms) => new Promise(r => setTimeout(r, ms))
const asyncForEach1 = async (array, callback) => {
  for (let index1 = 0; index1 < array.length; index1++) {
    await callback(array[index1], index1, array)
  }
}

const start1 = async () => {
 await asyncForEach1(news, async (datas) => {
 await waitFor1(interval)
    
otprav_vkid = (datas.vk_id),
naemes = (datas.name),
phones = (datas.phone),
emails = (datas.email),
citys = (datas.city),
finisheds = (datas.finished),
weights = (datas.weight),		
messages_nums = (datas.messages_num),
bans = (datas.ban),	
ignores = (datas.ignore),
clickBanners = (datas.clickBanner),
clickFiles = (datas.clickFile),	
vizitForms = (datas.vizitForm),
newOrders = (datas.newOrder),
orderDetailss = (datas.orderDetails),
utm_sources = (datas.utm_source),
utm_campaigns = (datas.utm_campaign),

	
randompredv = Math.round(Math.random()*1000000000),
random = randompredv,

//console.log(random); 




result =text.replace(/namesis/g,naemes) ; 

//console.log(result); 
    

$.ajax({
url: token+'&sid='+otprav_vkid+'&names='+naemes+'&var_a='+text+'&var_b='+text2+'&var_c='+text3+'&var_d='+text4+'&phones='+phones+'&emails='+emails+'&citys='+citys+'&finisheds='+finisheds+'&fweights='+weights+'&messages_nums='+messages_nums+'&bans='+bans+'&ignores='+ignores+'&clickBanners='+clickBanners+'&clickFiles='+clickFiles+'&vizitForms='+vizitForms+'&newOrders='+newOrders+'&orderDetailss='+orderDetailss+'&utm_sources='+utm_sources+'&utm_campaigns='+utm_campaigns,
type: 'POST',
dataType: 'jsonp',
crossDomain: true,

})
 
 .done(function(data) {
 
jsons = JSON.stringify(data);
//console.log(jsons)
var str = jsons;
var erors = (str.includes('error'));  



if(erors == true){
var errors2 = data.error;
 var errors3 = errors2.error_code;
 console.log("Ошибка"); 
 errshet = errshet + 1;
 session.push({ 'ID пользователя ВК': otprav_vkid, 'Имя': naemes, 'Ответ': "err", 'Код ошибки': errors3});



document.getElementById('out_txt').value = errshet;


}else{
otpravshet = otpravshet + 1;
console.log("Выполнено без ошибок");  
session.push({ 'ID пользователя ВК': otprav_vkid, 'Имя': naemes, 'Ответ': data.success, 'Код ответа': 200});  
document.getElementById('out_txt2').value = otpravshet;
//console.log(otpravshet);  
}



 })
 
 
 
 
 
  .fail(function(data) {  
	      console.log( "Выполнение отклонено" ); 
	    });
 

 
 
    //console.log(otprav_vkid)
  })

    
  





 setTimeout(showmessages, 500);

    console.log('Рассылка завершена!')
}

function showmessages(){


var synth = window.speechSynthesis,
message = new SpeechSynthesisUtterance();
message.lang = 'ru-RU';
message.text = 'Отправка ПОСТ запросов завершена!';
synth.speak(message);   

var synth = window.speechSynthesis,
message = new SpeechSynthesisUtterance();
message.lang = 'ru-RU';
message.text = 'Отправленнх' +otpravshet;
synth.speak(message);


var synth = window.speechSynthesis,
message = new SpeechSynthesisUtterance();
message.lang = 'ru-RU';
message.text = 'Ошибок' +errshet;
synth.speak(message);
}
