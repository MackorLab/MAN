!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("fs")):"function"==typeof define&&define.amd?define(["fs"],t):(e=e||self).whatsAppClient=t(e.fs)}(this,(function(e){"use strict";var t=function(e,t){return function(){for(var a=new Array(arguments.length),s=0;s<a.length;s++)a[s]=arguments[s];return e.apply(t,a)}},a=Object.prototype.toString;function s(e){return"[object Array]"===a.call(e)}function n(e){return void 0===e}function i(e){return null!==e&&"object"==typeof e}function r(e){if("[object Object]"!==a.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function o(e){return"[object Function]"===a.call(e)}function c(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),s(e))for(var a=0,n=e.length;a<n;a++)t.call(null,e[a],a,e);else for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.call(null,e[i],i,e)}var d={isArray:s,isArrayBuffer:function(e){return"[object ArrayBuffer]"===a.call(e)},isBuffer:function(e){return null!==e&&!n(e)&&null!==e.constructor&&!n(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:i,isPlainObject:r,isUndefined:n,isDate:function(e){return"[object Date]"===a.call(e)},isFile:function(e){return"[object File]"===a.call(e)},isBlob:function(e){return"[object Blob]"===a.call(e)},isFunction:o,isStream:function(e){return i(e)&&o(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)},forEach:c,merge:function e(){var t={};function a(a,n){r(t[n])&&r(a)?t[n]=e(t[n],a):r(a)?t[n]=e({},a):s(a)?t[n]=a.slice():t[n]=a}for(var n=0,i=arguments.length;n<i;n++)c(arguments[n],a);return t},extend:function(e,a,s){return c(a,(function(a,n){e[n]=s&&"function"==typeof a?t(a,s):a})),e},trim:function(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")},stripBOM:function(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e}};function u(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var h=function(e,t,a){if(!t)return e;var s;if(a)s=a(t);else if(d.isURLSearchParams(t))s=t.toString();else{var n=[];d.forEach(t,(function(e,t){null!=e&&(d.isArray(e)?t+="[]":e=[e],d.forEach(e,(function(e){d.isDate(e)?e=e.toISOString():d.isObject(e)&&(e=JSON.stringify(e)),n.push(u(t)+"="+u(e))})))})),s=n.join("&")}if(s){var i=e.indexOf("#");-1!==i&&(e=e.slice(0,i)),e+=(-1===e.indexOf("?")?"?":"&")+s}return e};function l(){this.handlers=[]}l.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},l.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},l.prototype.forEach=function(e){d.forEach(this.handlers,(function(t){null!==t&&e(t)}))};var g=l,p=function(e,t,a){return d.forEach(a,(function(a){e=a(e,t)})),e},f=function(e){return!(!e||!e.__CANCEL__)},m=function(e,t){d.forEach(e,(function(a,s){s!==t&&s.toUpperCase()===t.toUpperCase()&&(e[t]=a,delete e[s])}))},v=function(e,t,a,s,n){return function(e,t,a,s,n){return e.config=t,a&&(e.code=a),e.request=s,e.response=n,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},e}(new Error(e),t,a,s,n)},b=d.isStandardBrowserEnv()?{write:function(e,t,a,s,n,i){var r=[];r.push(e+"="+encodeURIComponent(t)),d.isNumber(a)&&r.push("expires="+new Date(a).toGMTString()),d.isString(s)&&r.push("path="+s),d.isString(n)&&r.push("domain="+n),!0===i&&r.push("secure"),document.cookie=r.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},y=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],I=d.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),a=document.createElement("a");function s(e){var s=e;return t&&(a.setAttribute("href",s),s=a.href),a.setAttribute("href",s),{href:a.href,protocol:a.protocol?a.protocol.replace(/:$/,""):"",host:a.host,search:a.search?a.search.replace(/^\?/,""):"",hash:a.hash?a.hash.replace(/^#/,""):"",hostname:a.hostname,port:a.port,pathname:"/"===a.pathname.charAt(0)?a.pathname:"/"+a.pathname}}return e=s(window.location.href),function(t){var a=d.isString(t)?s(t):t;return a.protocol===e.protocol&&a.host===e.host}}():function(){return!0},M=function(e){return new Promise((function(t,a){var s=e.data,n=e.headers;d.isFormData(s)&&delete n["Content-Type"];var i=new XMLHttpRequest;if(e.auth){var r=e.auth.username||"",o=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";n.Authorization="Basic "+btoa(r+":"+o)}var c,u,l=(c=e.baseURL,u=e.url,c&&!/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(u)?function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}(c,u):u);if(i.open(e.method.toUpperCase(),h(l,e.params,e.paramsSerializer),!0),i.timeout=e.timeout,i.onreadystatechange=function(){if(i&&4===i.readyState&&(0!==i.status||i.responseURL&&0===i.responseURL.indexOf("file:"))){var s,n,r,o,c,u="getAllResponseHeaders"in i?(s=i.getAllResponseHeaders(),c={},s?(d.forEach(s.split("\n"),(function(e){if(o=e.indexOf(":"),n=d.trim(e.substr(0,o)).toLowerCase(),r=d.trim(e.substr(o+1)),n){if(c[n]&&y.indexOf(n)>=0)return;c[n]="set-cookie"===n?(c[n]?c[n]:[]).concat([r]):c[n]?c[n]+", "+r:r}})),c):c):null,h={data:e.responseType&&"text"!==e.responseType?i.response:i.responseText,status:i.status,statusText:i.statusText,headers:u,config:e,request:i};!function(e,t,a){var s=a.config.validateStatus;a.status&&s&&!s(a.status)?t(v("Request failed with status code "+a.status,a.config,null,a.request,a)):e(a)}(t,a,h),i=null}},i.onabort=function(){i&&(a(v("Request aborted",e,"ECONNABORTED",i)),i=null)},i.onerror=function(){a(v("Network Error",e,null,i)),i=null},i.ontimeout=function(){var t="timeout of "+e.timeout+"ms exceeded";e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),a(v(t,e,"ECONNABORTED",i)),i=null},d.isStandardBrowserEnv()){var g=(e.withCredentials||I(l))&&e.xsrfCookieName?b.read(e.xsrfCookieName):void 0;g&&(n[e.xsrfHeaderName]=g)}if("setRequestHeader"in i&&d.forEach(n,(function(e,t){void 0===s&&"content-type"===t.toLowerCase()?delete n[t]:i.setRequestHeader(t,e)})),d.isUndefined(e.withCredentials)||(i.withCredentials=!!e.withCredentials),e.responseType)try{i.responseType=e.responseType}catch(t){if("json"!==e.responseType)throw t}"function"==typeof e.onDownloadProgress&&i.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&i.upload&&i.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then((function(e){i&&(i.abort(),a(e),i=null)})),s||(s=null),i.send(s)}))},w={"Content-Type":"application/x-www-form-urlencoded"};function R(e,t){!d.isUndefined(e)&&d.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var S,A={adapter:(("undefined"!=typeof XMLHttpRequest||"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process))&&(S=M),S),transformRequest:[function(e,t){return m(t,"Accept"),m(t,"Content-Type"),d.isFormData(e)||d.isArrayBuffer(e)||d.isBuffer(e)||d.isStream(e)||d.isFile(e)||d.isBlob(e)?e:d.isArrayBufferView(e)?e.buffer:d.isURLSearchParams(e)?(R(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):d.isObject(e)?(R(t,"application/json;charset=utf-8"),JSON.stringify(e)):e}],transformResponse:[function(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(e){return e>=200&&e<300}};A.headers={common:{Accept:"application/json, text/plain, */*"}},d.forEach(["delete","get","head"],(function(e){A.headers[e]={}})),d.forEach(["post","put","patch"],(function(e){A.headers[e]=d.merge(w)}));var P=A;function k(e){e.cancelToken&&e.cancelToken.throwIfRequested()}var C=function(e){return k(e),e.headers=e.headers||{},e.data=p(e.data,e.headers,e.transformRequest),e.headers=d.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),d.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||P.adapter)(e).then((function(t){return k(e),t.data=p(t.data,t.headers,e.transformResponse),t}),(function(t){return f(t)||(k(e),t&&t.response&&(t.response.data=p(t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))},_=function(e,t){t=t||{};var a={},s=["url","method","data"],n=["headers","auth","proxy","params"],i=["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","timeoutMessage","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","decompress","maxContentLength","maxBodyLength","maxRedirects","transport","httpAgent","httpsAgent","cancelToken","socketPath","responseEncoding"],r=["validateStatus"];function o(e,t){return d.isPlainObject(e)&&d.isPlainObject(t)?d.merge(e,t):d.isPlainObject(t)?d.merge({},t):d.isArray(t)?t.slice():t}function c(s){d.isUndefined(t[s])?d.isUndefined(e[s])||(a[s]=o(void 0,e[s])):a[s]=o(e[s],t[s])}d.forEach(s,(function(e){d.isUndefined(t[e])||(a[e]=o(void 0,t[e]))})),d.forEach(n,c),d.forEach(i,(function(s){d.isUndefined(t[s])?d.isUndefined(e[s])||(a[s]=o(void 0,e[s])):a[s]=o(void 0,t[s])})),d.forEach(r,(function(s){s in t?a[s]=o(e[s],t[s]):s in e&&(a[s]=o(void 0,e[s]))}));var u=s.concat(n).concat(i).concat(r),h=Object.keys(e).concat(Object.keys(t)).filter((function(e){return-1===u.indexOf(e)}));return d.forEach(h,c),a};function T(e){this.defaults=e,this.interceptors={request:new g,response:new g}}T.prototype.request=function(e){"string"==typeof e?(e=arguments[1]||{}).url=arguments[0]:e=e||{},(e=_(this.defaults,e)).method?e.method=e.method.toLowerCase():this.defaults.method?e.method=this.defaults.method.toLowerCase():e.method="get";var t=[C,void 0],a=Promise.resolve(e);for(this.interceptors.request.forEach((function(e){t.unshift(e.fulfilled,e.rejected)})),this.interceptors.response.forEach((function(e){t.push(e.fulfilled,e.rejected)}));t.length;)a=a.then(t.shift(),t.shift());return a},T.prototype.getUri=function(e){return e=_(this.defaults,e),h(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},d.forEach(["delete","get","head","options"],(function(e){T.prototype[e]=function(t,a){return this.request(_(a||{},{method:e,url:t,data:(a||{}).data}))}})),d.forEach(["post","put","patch"],(function(e){T.prototype[e]=function(t,a,s){return this.request(_(s||{},{method:e,url:t,data:a}))}}));var N=T;function D(e){this.message=e}D.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},D.prototype.__CANCEL__=!0;var L=D;function U(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var a=this;e((function(e){a.reason||(a.reason=new L(e),t(a.reason))}))}U.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},U.source=function(){var e;return{token:new U((function(t){e=t})),cancel:e}};var x=U;function E(e){var a=new N(e),s=t(N.prototype.request,a);return d.extend(s,N.prototype,a),d.extend(s,a),s}var j=E(P);j.Axios=N,j.create=function(e){return E(_(j.defaults,e))},j.Cancel=L,j.CancelToken=x,j.isCancel=f,j.all=function(e){return Promise.all(e)},j.spread=function(e){return function(t){return e.apply(null,t)}},j.isAxiosError=function(e){return"object"==typeof e&&!0===e.isAxiosError};var O=j,B=j;O.default=B;var q=O;class ${static validateString(e,t){if(!t||"[object String]"!==Object.prototype.toString.call(t))throw new Error(`${e} must be a String!`)}static validateInteger(e,t){if(!Number.isInteger(t))throw new Error(`${e} must be an integer!`)}static validateNumber(e,t){if(!t||!Number(t))throw new Error(`${e} must be a number!`)}static validateObject(e,t){if(!t||"[object Object]"!==Object.prototype.toString.call(t))throw new Error(`${e} must be an Object!`)}static generateMethodURL(e,t,a){return`${e.host}/waInstance${e.idInstance}/${t}/${e.apiTokenInstance}`}static validateChatIdPhoneNumber(e,t){e||$.validateInteger("phoneNumber",t),t||$.validateString("chatId",e)}static validateArray(e,t){if(!t||!Array.isArray(t))throw new Error(`${e} must be an Array!`)}static validatePath(t,a){if(!a||!e.existsSync(a))throw new Error(`${t} not found!`)}}class F{constructor(e){this._restAPI=e}async sendMessage(e,t,a){$.validateChatIdPhoneNumber(e,t),$.validateString("message",a);const s={message:a};this.addChadIdParam(s,e),this.addPhoneParam(s,t);return(await q.post($.generateMethodURL(this._restAPI.params,"sendMessage"),s)).data}async sendLocation(e,t,a,s,n,i){$.validateChatIdPhoneNumber(e,t),$.validateString("nameLocation",a),$.validateString("address",s),$.validateNumber("latitude",n),$.validateNumber("longitude",i);const r={nameLocation:a,address:s,latitude:n,longitude:i};this.addChadIdParam(r,e),this.addPhoneParam(r,t);return(await q.post($.generateMethodURL(this._restAPI.params,"sendLocation"),r)).data}async sendContact(e,t,a){$.validateChatIdPhoneNumber(e,t),$.validateObject("contact",a);const s={contact:a};this.addChadIdParam(s,e),this.addPhoneParam(s,t);return(await q.post($.generateMethodURL(this._restAPI.params,"sendContact"),s)).data}async sendLink(e,t,a){$.validateChatIdPhoneNumber(e,t),$.validateString("urlLink",a);const s={urlLink:a};this.addChadIdParam(s,e),this.addPhoneParam(s,t);return(await q.post($.generateMethodURL(this._restAPI.params,"sendLink"),s)).data}async readChat(e,t,a=null){$.validateChatIdPhoneNumber(e,t);const s={idMessage:a};this.addChadIdParam(s,e),this.addPhoneParam(s,t);return(await q.post($.generateMethodURL(this._restAPI.params,"readChat"),s)).data}async showMessagesQueue(){return(await q.get($.generateMethodURL(this._restAPI.params,"showMessagesQueue"))).data.map((e=>new W(e)))}async clearMessagesQueue(){return(await q.get($.generateMethodURL(this._restAPI.params,"clearMessagesQueue"))).data}async lastIncomingMessages(){return(await q.get($.generateMethodURL(this._restAPI.params,"lastIncomingMessages"))).data.map((e=>new G(e)))}async lastOutgoingMessages(){return(await q.get($.generateMethodURL(this._restAPI.params,"lastOutgoingMessages"))).data.map((e=>new G(e)))}addChadIdParam(e,t){t&&(e.chatId=t)}addPhoneParam(e,t){t&&(e.chatId=`${t}@c.us`)}}class G{constructor(e){this.chatId=e.chatId,this.idMessage=e.idMessage,this.statusMessage=e.statusMessage,this.textMessage=e.textMessage,this.timestamp=e.timestamp,this.typeMessage=e.typeMessage}}class W{constructor(e){this.chatId=e.chatId,this.fileName=e.fileName,this.typeMessage=e.typeMessage}}class H{constructor(e){this._restAPI=e}async sendFileByUrl(e,t,a,s,n=""){$.validateChatIdPhoneNumber(e,t),$.validateString("urlFile",a),$.validateString("filename",s);const i={urlFile:a,fileName:s,caption:n};this.addChadIdParam(i,e),this.addPhoneParam(i,t);return(await q.post($.generateMethodURL(this._restAPI.params,"sendFileByUrl"),i)).data}async sendFileByUpload(e){return(await q({method:"post",url:$.generateMethodURL(this._restAPI.params,"sendFileByUpload"),data:e,...e.getHeaders()})).data}async downloadFile(e){$.validateString("messageId",e);const t=`${this._restAPI.params.host}/waInstance${this._restAPI.params.idInstance}/downloadFile/${e}`;return(await q.get(t)).data}addChadIdParam(e,t){t&&(e.chatId=t)}addPhoneParam(e,t){t&&(e.phoneNumber=t)}}class V{constructor(e){this._restAPI=e}async qr(){return(await q.get($.generateMethodURL(this._restAPI.params,"qr"))).data}async logout(){return(await q.get($.generateMethodURL(this._restAPI.params,"logout"))).data}async reboot(){return(await q.get($.generateMethodURL(this._restAPI.params,"reboot"))).data}async getStateInstance(){return(await q.get($.generateMethodURL(this._restAPI.params,"getStateInstance"))).data}async getDeviceInfo(){return(await q.get($.generateMethodURL(this._restAPI.params,"getDeviceInfo"))).data}async checkWhatsapp(e){$.validateInteger("phoneNumber",e);const t={phoneNumber:e};return(await q.post($.generateMethodURL(this._restAPI.params,"checkWhatsapp"),t)).data}async getAvatar(e,t){$.validateChatIdPhoneNumber(e,t);const a={};this.addChadIdParam(a,e),this.addPhoneParam(a,t);return(await q.post($.generateMethodURL(this._restAPI.params,"getAvatar"),a)).data}async getContacts(){return(await q.get($.generateMethodURL(this._restAPI.params,"getContacts"))).data}addChadIdParam(e,t){t&&(e.chatId=t)}addPhoneParam(e,t){t&&(e.phoneNumber=t)}}class z{constructor(e){this._restAPI=e}async getSettings(){return(await q.get($.generateMethodURL(this._restAPI.params,"getSettings"))).data}async setSettings(e){$.validateObject("settings",e);const t=e;return(await q.post($.generateMethodURL(this._restAPI.params,"setSettings"),t)).data}}class J{constructor(e){this._restAPI=e}async createGroup(e,t,a){$.validateString("groupName",e),$.validateArray("chatIds",t),$.validateArray("phones",a);const s={groupName:e,chatIds:t,phones:a};return(await q.post($.generateMethodURL(this._restAPI.params,"createGroup"),s)).data}async addGroupParticipant(e,t,a){$.validateString("groupId",e),$.validateChatIdPhoneNumber(t,a);const s={groupId:e,participantChatId:t,participantPhone:a};return(await q.post($.generateMethodURL(this._restAPI.params,"addGroupParticipant"),s)).data}async getGroupData(e){$.validateString("groupId",e);const t={groupId:e};return(await q.post($.generateMethodURL(this._restAPI.params,"getGroupData"),t)).data}async removeGroupParticipant(e,t,a){$.validateString("groupId",e),$.validateChatIdPhoneNumber(t,a);const s={groupId:e,participantChatId:t,participantPhone:a};return(await q.post($.generateMethodURL(this._restAPI.params,"removeGroupParticipant"),s)).data}async updateGroupName(e,t){$.validateString("groupId",e),$.validateString("groupName",t);const a={groupId:e,groupName:t};return(await q.post($.generateMethodURL(this._restAPI.params,"updateGroupName"),a)).data}async setGroupAdmin(e,t,a){$.validateString("groupId",e);const s={groupId:e,participantChatId:t,participantPhone:a};return(await q.post($.generateMethodURL(this._restAPI.params,"setGroupAdmin"),s)).data}async removeAdmin(e,t,a){$.validateString("groupId",e);const s={groupId:e,participantChatId:t,participantPhone:a};return(await q.post($.generateMethodURL(this._restAPI.params,"removeAdmin"),s)).data}async leaveGroup(e){$.validateString("groupId",e);const t={groupId:e};return(await q.post($.generateMethodURL(this._restAPI.params,"removeAdmin"),t)).data}}class X{initJobs(e=[]){this.jobs=e}reschedule(){this.jobs.forEach((e=>{e.needInterrupt=!1,clearInterval(e.timerId),e.timerId=setInterval(e.run,1e3*e.intervalSec)}))}unschedule(){this.jobs.forEach((e=>{e.needInterrupt=!0,clearInterval(e.timerId)}))}}class K{timerId;intervalSec;needInterrupt=!1;constructor(e){this.webhookServiceApi=e,this.intervalSec=Number.parseInt("1")}run=async()=>{clearInterval(this.timerId);try{let e;for(;e=await this.webhookServiceApi.receiveNotification();){let t=e.body;t.typeWebhook===this.webhookServiceApi.noteTypes.incomingMessageReceived?"imageMessage"==t.messageData.typeMessage?this.callCallback(this.webhookServiceApi.callbackTypes.onReceivingMessageImage,t):"videoMessage"==t.messageData.typeMessage?this.callCallback(this.webhookServiceApi.callbackTypes.onReceivingMessageVideo,t):"documentMessage"==t.messageData.typeMessage?this.callCallback(this.webhookServiceApi.callbackTypes.onReceivingMessageDocument,t):"audioMessage"==t.messageData.typeMessage?this.callCallback(this.webhookServiceApi.callbackTypes.onReceivingMessageAudio,t):"documentMessage"==t.messageData.typeMessage?this.callCallback(this.webhookServiceApi.callbackTypes.onReceivingMessageDocument,t):"textMessage"==t.messageData.typeMessage?this.callCallback(this.webhookServiceApi.callbackTypes.onReceivingMessageText,t):"extendedTextMessage"==t.messageData.typeMessage?this.callCallback(this.webhookServiceApi.callbackTypes.onReceivingMessageTextURL,t):"contactMessage"==t.messageData.typeMessage?this.callCallback(this.webhookServiceApi.callbackTypes.onReceivingMessageContact,t):"locationMessage"==t.messageData.typeMessage&&this.callCallback(this.webhookServiceApi.callbackTypes.onReceivingMessageLocation,t):t.typeWebhook===this.webhookServiceApi.noteTypes.stateInstanceChanged?this.callCallback(this.webhookServiceApi.callbackTypes.onReceivingAccountStatus,t):t.typeWebhook===this.webhookServiceApi.noteTypes.outgoingMessageStatus?this.callCallback(this.webhookServiceApi.callbackTypes.onReceivingOutboundMessageStatus,t):t.typeWebhook===this.webhookServiceApi.noteTypes.deviceInfo&&this.callCallback(this.webhookServiceApi.callbackTypes.onReceivingDeviceStatus,t),await this.webhookServiceApi.deleteNotification(e.receiptId)}}catch(e){console.error(e.toString())}this.needInterrupt||(this.timerId=setInterval(this.run,1e3*this.intervalSec))};callCallback(e,t){const a=this.webhookServiceApi._callbacks.get(e);a&&a.call(this,t)}}class Q{constructor(e){this._restAPI=e,this._jobScheduler=new X,this.noteTypes={incomingMessageReceived:"incomingMessageReceived",outgoingMessageStatus:"outgoingMessageStatus",stateInstanceChanged:"stateInstanceChanged",deviceInfo:"deviceInfo"},this.callbackTypes={onReceivingMessageText:"onReceivingMessageText",onReceivingMessageImage:"onReceivingMessageImage",onReceivingMessageVideo:"onReceivingMessageVideo",onReceivingMessageDocument:"onReceivingMessageDocument",onReceivingMessageAudio:"onReceivingMessageAudio",onReceivingOutboundMessageStatus:"onReceivingOutboundMessageStatus",onReceivingAccountStatus:"onReceivingAccountStatus",onReceivingDeviceStatus:"onReceivingDeviceStatus",onReceivingMessageTextURL:"onReceivingMessageTextURL",onReceivingMessageContact:"onReceivingMessageContact",onReceivingMessageLocation:"onReceivingMessageLocation"},this._callbacks=new Map}async receiveNotification(){return(await q.get($.generateMethodURL(this._restAPI.params,"receiveNotification"))).data}async deleteNotification(e){$.validateInteger("receiptId",e);return(await q.delete(`${$.generateMethodURL(this._restAPI.params,"deleteNotification")}/${e}`)).data}async startReceivingNotifications(){this._jobScheduler.initJobs([new K(this)]),this._jobScheduler.reschedule()}async stopReceivingNotifications(){this._jobScheduler.unschedule()}onReceivingMessageText(e){this._callbacks.set(this.callbackTypes.onReceivingMessageText,e)}onReceivingMessageImage(e){this._callbacks.set(this.callbackTypes.onReceivingMessageImage,e)}onReceivingMessageVideo(e){this._callbacks.set(this.callbackTypes.onReceivingMessageVideo,e)}onReceivingMessageDocument(e){this._callbacks.set(this.callbackTypes.onReceivingMessageDocument,e)}onReceivingMessageAudio(e){this._callbacks.set(this.callbackTypes.onReceivingMessageAudio,e)}onReceivingOutboundMessageStatus(e){this._callbacks.set(this.callbackTypes.onReceivingOutboundMessageStatus,e)}onReceivingAccountStatus(e){this._callbacks.set(this.callbackTypes.onReceivingAccountStatus,e)}onReceivingDeviceStatus(e){this._callbacks.set(this.callbackTypes.onReceivingDeviceStatus,e)}onReceivingMessageTextURL(e){this._callbacks.set(this.callbackTypes.onReceivingMessageTextURL,e)}onReceivingMessageContact(e){this._callbacks.set(this.callbackTypes.onReceivingMessageContact,e)}onReceivingMessageLocation(e){this._callbacks.set(this.callbackTypes.onReceivingMessageLocation,e)}}class Y{constructor(t){this.params={host:"",idInstance:"",apiTokenInstance:"",credentialsPath:null},Object.assign(this.params,t),t.credentialsPath&&e.readFileSync(t.credentialsPath).toString("utf8").split("\n").map((e=>e.split(" ").join(""))).forEach((e=>{e.startsWith("API_TOKEN_INSTANCE=")?this.params.apiTokenInstance=e.replace("API_TOKEN_INSTANCE=","").trim():e.startsWith("ID_INSTANCE=")&&(this.params.idInstance=e.replace("ID_INSTANCE=","").trim())})),this.message=new F(this),this.file=new H(this),this.instance=new V(this),this.settings=new z(this),this.group=new J(this),this.webhookService=new Q(this)}}var Z="https://api.green-api.com";class ee{constructor(e,t){this._app=e,this._webhookRoutePath=t,this._callbacks=new Map}init(){this._app.post(this._webhookRoutePath,(async(e,t,a)=>{try{console.log(`Received webhook ${e.body.typeWebhook}`);let a=null;a=e.body.messageData&&e.body.messageData.typeMessage?`${e.body.typeWebhook}_${e.body.messageData.typeMessage}`:e.body.typeWebhook;const s=this._callbacks.get(a);return s&&s.call(this,e.body),t.send()}catch(e){a(e)}}))}onStateInstance(e){this._callbacks.set("stateInstanceChanged",e)}onOutgoingMessageStatus(e){this._callbacks.set("outgoingMessageStatus",(t=>{e.call(this,t,t.instanceData.idInstance,t.idMessage,t.status)}))}onIncomingMessageText(e){this._callbacks.set("incomingMessageReceived_textMessage",(t=>{e.call(this,t,t.instanceData.idInstance,t.idMessage,t.senderData.sender,t.messageData.typeMessage,t.messageData.textMessageData.textMessage)}))}onIncomingMessageFile(e){this._callbacks.set("incomingMessageReceived_imageMessage",(t=>{e.call(this,t,t.instanceData.idInstance,t.idMessage,t.senderData.sender,t.messageData.typeMessage,t.messageData.downloadUrl)}))}onIncomingMessageLocation(e){this._callbacks.set("incomingMessageReceived_locationMessage",(t=>{e.call(this,t,t.instanceData.idInstance,t.idMessage,t.senderData.sender,t.messageData.typeMessage,t.messageData.locationMessageData.latitude,t.messageData.locationMessageData.longitude,t.messageData.locationMessageData.jpegThumbnail)}))}onIncomingMessageContact(e){this._callbacks.set("incomingMessageReceived_contactMessage",(t=>{e.call(this,t,t.instanceData.idInstance,t.idMessage,t.senderData.sender,t.messageData.typeMessage,t.messageData.contactMessageData.displayName,t.messageData.contactMessageData.vcard)}))}onIncomingMessageExtendedText(e){this._callbacks.set("incomingMessageReceived_extendedTextMessage",(t=>{e.call(this,t,t.instanceData.idInstance,t.idMessage,t.senderData.sender,t.messageData.typeMessage,t.extendedTextMessageData)}))}onDeviceInfo(e){this._callbacks.set("deviceInfo",e)}}return{restAPI:(e={})=>(function(e={}){e.host?$.validateString("host",e.host):e.host=Z,e.credentialsPath?$.validatePath("credentialsPath",e.credentialsPath):($.validateString("idInstance",e.idInstance),$.validateString("apiTokenInstance",e.apiTokenInstance))}(e),new Y(e)),webhookAPI:(e,t)=>{const a=new ee(e,t);return a.init(),a}}}));
