
  const waitFor1 = (ms) => new Promise(r => setTimeout(r, ms))
const asyncForEach1 = async (array, callback) => {
  for (let index1 = 0; index1 < array.length; index1++) {
    await callback(array[index1], index1, array)
  }
}

const start3 = async () => {
 await asyncForEach1(news, async (datas) => {
 await waitFor1(interval)
    
otprav_vkid = (datas.vk_id),
naemes = (datas.name),
phones = (datas.phone),
emails = (datas.email),
citys = (datas.city),
finisheds = (datas.finished),
weights = (datas.weight),		
messages_nums = (datas.messages_num),
bans = (datas.ban),	
ignores = (datas.ignore),
clickBanners = (datas.clickBanner),
clickFiles = (datas.clickFile),	
vizitForms = (datas.vizitForm),
newOrders = (datas.newOrder),
orderDetailss = (datas.orderDetails),
utm_sources = (datas.utm_source),
utm_campaigns = (datas.utm_campaign),

	
randompredv = Math.round(Math.random()*1000000000),
random = randompredv,

console.log(random); 




result =text.replace(/namesis/g,naemes) ; 

console.log(result); 
 
	 
	 
var base =  {
  "user":{
      "email":emails,
       "first_name":naemes,
      
      "addfields":{"test1":bans,"test2":citys} // для добавления дополнительных полей пользователя
  },
  "system":{
      "refresh_if_exists":1, // обновлять ли существующего пользователя 1/0 да/нет
      
  },
  "session":{
      "utm_source":"",
      "utm_medium":"",
      "utm_content":numbers,
      "utm_campaign":"",
      "utm_group":"",
      "gcpc":"",
      "gcao":"",
      "referer":""
  }
};
	 
	 
var basestr = JSON.stringify(base);
var based64 = Base64.encode(basestr);
console.log(based64);
	 
	 
	

$.ajax({
url: 'https://'+token,
type: 'POST',
headers: ("content-type: multipart/form-data"),
dataType: 'jsonp',
crossDomain: true,

})
 
 .done(function(data) {
 
jsons = JSON.stringify(data);
console.log(jsons)
var str = jsons;
var erors = (str.includes('error'));  



if(erors == true){
var errors2 = data.error;
 var errors3 = errors2.error_code;
 console.log("Ошибка"); 
 errshet = errshet + 1;
 session.push({ 'ID пользователя ВК': otprav_vkid, 'Имя': naemes, 'Ответ': "err", 'Код ошибки': errors3});



document.getElementById('out_txt').value = errshet;


}else{
otpravshet = otpravshet + 1;
console.log("Выполнено без ошибок");  
session.push({ 'ID пользователя ВК': otprav_vkid, 'Имя': naemes, 'Ответ': data.success, 'Код ответа': 200});  
document.getElementById('out_txt2').value = otpravshet;
console.log(otpravshet);  
}



 })
 
 
 
 
 
  .fail(function(data) {  
	      console.log( "Выполнение отклонено" ); 
	    });
 

 
 
    console.log(otprav_vkid)
  })

    
  







    console.log('Рассылка завершена!')
}
